name: Deepfactor scan image
description: Scan a docker image using Deepfactor

inputs:
  image:
    description: The name of the image to deploy, should already be built
    required: true
  deepfactor_run_token:
    description: The deepfactor run token
    required: true

runs:
  using: composite
  steps:
    - name: Install dfctl
      env:
        DF_RUN_TOKEN: ${{ inputs.deepfactor_run_token }}
      shell: bash
      run: ${{ vars.DEEPFACTOR_INSTALL_DFCTL }}

    - name: Deepfactor scan
      env:
        DF_RUN_TOKEN: ${{ inputs.deepfactor_run_token }}
        IMAGE: ${{ inputs.image }}
      shell: bash
      run: dfctl scan $IMAGE
